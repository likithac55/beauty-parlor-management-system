{% extends 'navigation.html' %}
{% load static %}
{% block body %}
<div class="container">
    <center>
        <h3 style="color:red">PAYMENT DETAIL</h3>
        <hr>
    </center>
    <center>
        <div style="width:55%;background-color:lightgrey" class="jumbotron">
            <div class="container">
                <div class="row">
                    <!-- You can make it whatever width you want. I'm making it full width
             on <= small devices and 4/12 page width on >= medium devices -->
                    <div class="col-xs-4 col-md-4">
                        <img style="width:150px;height:100px" class="img-responsive pull-right"
                            src="{% static 'images/atm1.jpg'%}">
                    </div>
                    <div class="col-xs-4 col-md-4">
                        <img style="width:150px;height:100px" class="img-responsive pull-right"
                            src="{% static 'images/atm2.jpg'%}">
                    </div>
                    <div class="col-xs-4 col-md-4">
                        <img style="width:150px;height:100px" class="img-responsive pull-right"
                            src="{% static 'images/atm3.jpg'%}">
                    </div>
                </div>

                <form action="{% url 'view_appointment' %}" method="POST">
                    {% csrf_token %}


                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label style="margin:10px" for="cardNumber">CARD NUMBER</label>
                                <div class="input-group">
                                    <ion-icon style="font-size:40px;margin-right:4px" name="card"></ion-icon><input
                                        style="margin:10px" type="tel" class="form-control" name="cardnumber"
                                        placeholder="Valid Card Number" autocomplete="cc-number" maxlength="12"
                                        pattern="\d{12}" required autofocus />
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if error_message %}
                      <p style="color: red;">{{ error_message }}</p>
                    {% endif %}
                    <div class="row">
                        <div class=" col-md-6">
                            <div class="form-group">
                                <label for="cardExpiry"><span class="hidden-xs"></span><span
                                        class="visible-xs-inline">EXPIRY</span> DATE </label>
                                <input type="tel" class="form-control" name="cardex" placeholder="MM / YY"
                                pattern="(0[1-9]|1[0-2]) \/ ([0-9]{2})" 
                                 autocomplete="cc-exp" required onblur="validateExpiryDate(this)" />
                                    <small id="expiryError" style="color: red; display: none;">Expiry date must be greater than the current year.</small>
                            </div>
                        </div><br>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="cardCVC">CVC CODE </label>
                                <input type="tel" class="form-control" name="cvc" placeholder="CVC"
                                    autocomplete="cc-csc" required 
                                    maxlength="3" pattern="\d{3}" title="CVC code must be 3 digits"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label style="margin:10px" for="cardCVC">Card Holder Name</label>
                                <input style="margin:10px" type="tel" class="form-control" name="cvc"
                                    placeholder="Card Holder Name" autocomplete="cc-csc" required />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">

                                <label style="margin:10px" for="couponCode">Amount In Rs.</label>
                                <input style="margin:10px" type="text" class="form-control"
                                    value="{{book.service.cost}}" name="amount" readonly />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input style="color:white;font-size:20px" type="submit"
                                class="btn btn-success btn-lg btn-block" name="payment" value="payment"
                                onclick="showMessage()">
                        </div>

                        <div class="col-md-6">
                            <a href="{% url 'view_appointment' %}" class="btn btn-success btn-lg btn-block"
                                onclick="showMessage()">
                                <h6>Cash On Delivery</h6>
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </center>
</div>
<!-- <script type="text/javascript">
    function showMessage() {
        alert("Booking Successfully");
        window.location = "{% url 'view_appointment' %}";
    }
</script> -->
<script>
    document.querySelector('input[name="cardnumber"]').addEventListener('input', function () {
        this.value = this.value.replace(/\D/g, '').slice(0, 12); // Allow only digits and limit to 12 characters
    });
</script>
<!-- <script>
    function showMessage() {
        alert("Booking Successfully");
        window.location = "{% url 'view_appointment' %}";
    }
</script> -->

<script>
    document.querySelector('input[name="cardnumber"]').addEventListener('input', function () {
        this.value = this.value.replace(/\D/g, '').slice(0, 12); // Allow only digits and limit to 12 characters
    });
</script>

<!-- Replace the validateExpiryDate function with this new version -->
<script>
    function validateExpiryDate(input) {
        const value = input.value;

        // Regular expression to match MM / YY format
        const regex = /^(0[1-9]|1[0-2]) \/ (\d{2})$/;

        if (!regex.test(value)) {
            input.setCustomValidity("Please enter a valid expiry date in MM / YY format.");
            return;
        }

        const [_, month, year] = regex.exec(value);
        const currentYear = new Date().getFullYear() % 100; // Get last two digits of the current year
        const currentMonth = new Date().getMonth() + 1; // Get current month (1-12)

        // Check if the year is less than the current year or the same year but month is less than current month
        if (parseInt(year) < currentYear || (parseInt(year) === currentYear && parseInt(month) < currentMonth)) {
            input.setCustomValidity("Expiry date must be greater than the current month and year.");
            document.getElementById('expiryError').style.display = "inline"; // Display error message
        } else {
            input.setCustomValidity(""); // Reset error message if valid
            document.getElementById('expiryError').style.display = "none";
        }
    }
</script>

{% endblock %}