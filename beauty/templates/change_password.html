{% extends 'navigation.html' %}
{% block body %}
{% load static %}
<div class="container">
  <h2 style="margin-top:4%;font-family:'Monotype Corsiva';color:red" align="center">Change Password</h2>
  <hr>

  <div class="container-fluid" style="width:70%;margin-top:4%">
    <form method="post" action="">
      {% csrf_token %}
      <div class="form-group">
        <label for="exampleInputEmail1">Old Password</label>
        <input type="password" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" name="pwd3">
      </div>

      <div class="form-group">
        <label for="exampleInputEmail1">New Password</label>
        <input type="password" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" name="pwd1" oninput="checkPassword()">
        <small id="passwordHelp" class="form-text text-muted">
          Password should be at least 5 characters long, contain one number and one special character.
        </small>
        <small id="passwordValidation" class="form-text text-danger" style="display:none;"></small>
      </div>

      <div class="form-group">
        <label for="exampleInputPassword1">Confirm Password</label>
        <input type="password" class="form-control" id="exampleInputPassword1" name="pwd2" oninput="checkPasswordMatch()">
        <small id="passwordMatch" class="form-text text-danger" style="display:none;"></small>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>
</div>


{% if error == "yes" %}
<script>
  alert('Password Changed.....');
  window.location = ('{% url 'logout' %}')
</script>
{% endif %}
{% if error == "not" %}
<script>
  alert('New Password and Confirm Password are not match');
</script>
{% endif %}
{% if error == "invalid" %}
<script>
  alert('New Password must be at least 5 characters long and contain at least one number and one special character.');
</script>
{% endif %}
{% if error == "incorrect" %}
<script>
  alert('Old Password is incorrect.');
</script>
{% endif %}
{% if error == "same" %}
<script>
  alert('New Password must be different from Old Password.');
</script>
{% endif %}
<script>
  function validateForm() {
    const newPassword = document.getElementById("newPassword").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const passwordPattern = /^(?=.*[0-9])(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{5,}$/;

    if (!passwordPattern.test(newPassword)) {
      alert("New Password must be at least 5 characters long and contain at least one number and one special character.");
      return false;
    }

    if (newPassword !== confirmPassword) {
      alert("New Password and Confirm Password do not match.");
      return false;
    }

    return true;
  }
  function checkPassword() {
    const newPassword = document.getElementById("newPassword").value;
    const passwordValidation = document.getElementById("passwordValidation");
    const passwordPattern = /^(?=.*[0-9])(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{5,}$/;

    if (!passwordPattern.test(newPassword)) {
      passwordValidation.style.display = "block";
      passwordValidation.textContent = "Password must be at least 5 characters long and contain one number and one special character.";
    } else {
      passwordValidation.style.display = "none";
    }
  }

  function checkPasswordMatch() {
    const newPassword = document.getElementById("newPassword").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const passwordMatch = document.getElementById("passwordMatch");

    if (newPassword !== confirmPassword) {
      passwordMatch.style.display = "block";
      passwordMatch.textContent = "Passwords do not match.";
    } else {
      passwordMatch.style.display = "none";
    }
  }
</script>

{% endblock %}